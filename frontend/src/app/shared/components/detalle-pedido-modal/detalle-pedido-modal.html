<div class="modal-overlay" *ngIf="showModal" (click)="onClose()">
    <div class="modal-content" (click)="$event.stopPropagation()">

        <div *ngIf="!detalle">
            <p class="text-center py-5">Cargando detalles de pedido...</p>
        </div>

        <div class="container invoice-box" *ngIf="detalle">

            <button class="close-button" (click)="onClose()">×</button>

            <div class="row mb-3">
                <div class="col-6 d-flex align-items-center">
                    <img src="assets/ui/logo.jpg" alt="Logo" class="logo-empresa">
                    <span class="logo-text">Ikaza-Imports</span>
                </div>
                <div class="col-6 text-end header-box">
                    <h5 class="mb-1">RUC: 10715416846</h5>
                    <h6 class="mb-0">Comprobante de Venta</h6>
                    <h5 class="fw-bold text-success">#{{ detalle.numeroPedido }}</h5>
                </div>
            </div>

            <div class="row mb-3 info-clientes">
                <div class="col-6">
                    <p class="mb-1"><strong>Cliente: </strong> <span>{{ datosCliente?.nombreCompleto ||
                            datosCliente?.nombreRol }}</span></p>
                    <p class="mb-1"><strong>DNI/RUC: </strong> <span>{{ datosCliente?.numeroDocumento }}</span></p>
                    <p class="mb-1"><strong>Email: </strong> <span>{{ datosCliente?.email }}</span></p>
                    <p class="mb-1">
                        <strong>Teléfono: </strong>
                        <span>
                            {{ datosCliente?.prefijoTelefono ? '(' + datosCliente?.prefijoTelefono + ') ' : '' }}{{
                            datosCliente?.telefono }}
                        </span>
                    </p>
                    <p class="mb-1"><strong>Edad: </strong> <span>{{ datosCliente?.edad }}</span></p>
                    <p class="mb-1">
                        <strong>Estado: </strong>
                        <span class="fw-bold"
                            [ngClass]="{'text-success': detalle.estadoPedido === 'ENTREGADO', 'text-warning': detalle.estadoPedido !== 'ENTREGADO'}">
                            {{ detalle.estadoPedido }}
                        </span>
                    </p>
                </div>
                <div class="col-6 text-end">
                    <p class="mb-1">
                        <strong>Fecha de Pedido: </strong>
                        <span>{{ detalle.fechaPedido | date:'dd/MM/yyyy h:mm a' }}</span>
                    </p>
                    <p class="mt-2 mb-1">
                        <strong>Método de Pago: </strong>
                        <span>{{ detalle.metodoPago }}</span>
                        <br>
                        <small class="text-muted" *ngIf="detalle.ultimos4DigitosTarjeta">
                            {{ detalle.bancoEmisor }}: {{ detalle.ultimos4DigitosTarjeta | formatoUltimosDigitos }}
                        </small>
                    </p>
                    <p class="mb-1">
                        <strong>Estado de Pago:</strong>
                        <span class="fw-bold"
                            [ngClass]="{'text-success': detalle.estadoPago === 'APROBADO', 'text-danger': detalle.estadoPago === 'RECHAZADO'}">
                            {{ detalle.estadoPago }}
                        </span>
                    </p>
                </div>
            </div>

            <div class="row mb-2">
                <div class="col-12">
                    <table class="table table-sm">
                        <thead>
                            <tr class="bg-primary text-white">
                                <th>Cant.</th>
                                <th>Descripción</th>
                                <th>P.Unit</th>
                                <th class="text-end">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of detalle.detalles">
                                <td>{{ item.cantidad }}</td>
                                <td>
                                    {{ item.nombreProducto }}
                                    <small class="text-muted d-block"
                                        *ngIf="item.colorSeleccionado || item.tallaSeleccionada">
                                        ({{ item.colorSeleccionado }}{{ item.tallaSeleccionada ? ' - ' +
                                        item.tallaSeleccionada : '' }})
                                    </small>
                                </td>
                                <td>S/ {{ item.precioUnitario | number:'1.2-2' }}</td>
                                <td class="text-end">S/ {{ item.subtotal | number:'1.2-2' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="row info-totales">
                <div class="col-6">
                    <h6 class="fw-bold">Información Adicional:</h6>
                    <p class="mb-1">Notas: {{ detalle.transaccionId }}</p>
                </div>
                <div class="col-6 text-end">
                    <table class="table table-sm total-table">
                        <tbody>
                            <tr>
                                <td class="text-end border-0 fw-bold">Subtotal: S/</td>
                                <td class="text-end border-0">{{ detalle.subtotal | number:'1.2-2' }}</td>
                            </tr>
                            <tr>
                                <td class="text-end border-0 fw-bold">Envío (Asumido): S/</td>
                                <td class="text-end border-0">[Cálculo Envío]</td>
                            </tr>
                            <tr>
                                <td class="text-end border-0 fw-bold">Total Pagado: S/</td>
                                <td class="text-end border-0 fw-bold text-success fs-5">{{ detalle.total |
                                    number:'1.2-2' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>