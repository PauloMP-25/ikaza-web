<div class="alert alert-warning d-flex align-items-center mb-3" *ngIf="!isAuthenticated && cartItems.length > 0">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <small>Debes iniciar sesión para completar tu compra</small>
</div>

<div class="alert alert-info mb-3"
    *ngIf="isAuthenticated && !userHasCompleteData && cartItems.length > 0">
    <i class="bi bi-info-circle-fill me-2"></i>
    <small class="fw-semibold">Faltan datos en tu perfil:</small>
    <ul class="mb-0 small ps-4 pt-1">
        <!-- Mostrar la lista de requisitos faltantes -->
        <li *ngFor="let requirement of missingRequirements">{{ requirement }}</li>
    </ul>
</div>

<div class="flex-grow-1 overflow-auto mb-3">
    <ul class="list-group" *ngIf="cartItems.length > 0; else emptyCart">
        <li class="list-group-item border-0 border-bottom" *ngFor="let item of cartItems">
            <div class="d-flex gap-3">
                <img [src]="item.image || 'assets/images/no-image.png'" alt="item.nombreProducto"
                    class="cart-item-image rounded">

                <div class="flex-grow-1">
                    <h6 class="mb-1 fw-semibold">{{ item.nombreProducto }}</h6>

                    <small class="text-muted d-block" *ngIf="item.color || item.size">
                        <i class="bi bi-tag"></i>
                        {{ item.color }}{{ item.size ? ' - ' + item.size : '' }}
                    </small>

                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <span class="badge bg-light text-dark">
                            Cant: {{ item.qty || 1 }}
                        </span>
                        <small class="text-muted">
                            S/ {{ item.precio | number:'1.2-2' }} c/u
                        </small>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <span class="fw-bold text-success">
                            S/ {{ (item.precio * (item.qty || 1)) | number:'1.2-2' }}
                        </span>
                        <button type="button" class="btn btn-sm btn-outline-danger"
                            (click)="onRemoveItem(item.idProducto)" title="Eliminar producto">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </li>
    </ul>

    <ng-template #emptyCart>
        <div class="text-center py-5">
            <i class="bi bi-cart-x display-1 text-muted"></i>
            <p class="text-muted mt-3">Tu carrito está vacío</p>
            <p class="text-muted small">¡Agrega productos para empezar!</p>
        </div>
    </ng-template>
</div>

<div class="border-top pt-3" *ngIf="cartItems.length > 0">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Total:</h5>
        <h4 class="mb-0 text-success fw-bold">
            S/ {{ total | number:'1.2-2' }}
        </h4>
    </div>

    <div class="alert alert-success py-2 mb-3" *ngIf="total > 50">
        <small>
            <i class="bi bi-truck"></i> ¡Envío gratis en compras mayores a S/ 50!
        </small>
    </div>
    <div class="alert alert-info py-2 mb-3" *ngIf="total <= 50">
        <small>
            <i class="bi bi-info-circle"></i> Costo de envío: S/ 10.00
            <br>
            (Gratis en compras mayores a S/ 50)
        </small>
    </div>

    <div class="d-grid gap-2">
        <button class="btn btn-success btn-lg" (click)="onCheckout()"
            [disabled]="!isAuthenticated || !userHasCompleteData || cartItems.length === 0">
            <i class="bi" [ngClass]="paymentButtonIcon"></i>
            {{ paymentButtonText }}
        </button>

        <button class="btn btn-outline-danger" (click)="onClearCart()" *ngIf="cartItems.length > 0">
            <i class="bi bi-trash"></i> Vaciar Carrito
        </button>

        <button class="btn btn-outline-primary" data-bs-dismiss="offcanvas" routerLink="/catalogo">
            <i class="bi bi-arrow-left"></i> Seguir Comprando
        </button>
    </div>

    <div class="text-center mt-3">
        <small class="text-muted d-block mb-2">Métodos de pago:</small>
        <div class="d-flex justify-content-center gap-2 flex-wrap">
            <span class="badge bg-primary"><i class="bi bi-credit-card"></i> Tarjeta</span>
            <span class="badge bg-success"><i class="bi bi-phone"></i> Yape</span>
            <span class="badge bg-info"><i class="bi bi-bank"></i> Transferencia</span>
            <span class="badge bg-warning text-dark"><i class="bi bi-cash-coin"></i> Efectivo</span>
        </div>
    </div>
</div>