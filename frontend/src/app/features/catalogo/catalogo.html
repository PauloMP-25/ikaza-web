<div class="catalog-layout">

  <!-- SIDEBAR -->
  <aside class="catalog-sidebar">
    <h5><i class="bi bi-funnel me-2"></i> Filtros y Categorías</h5>

    <!-- BUSCAR -->
    <div class="sidebar-section">
      <h6>Buscar Producto</h6>
      <input type="text" class="form-control" placeholder="Buscar..." (input)="onSearch($event)">
    </div>

    <!-- CATEGORÍAS -->
    <div class="sidebar-section">
      <h6>Categorías</h6>

      <button class="category-filter-btn" [class.active]="filteredCategory === 'todos'"
        (click)="filterByCategory('todos')">
        <i class="bi bi-grid-3x3-gap me-2"></i> Todos
      </button>

      <button *ngFor="let cat of categories" class="category-filter-btn" [class.active]="filteredCategory === cat.value"
        (click)="filterByCategory(cat.value)">
        <i class="bi bi-tags me-2"></i> {{ cat.name }}
      </button>
    </div>

    <!-- PRECIO -->
    <div class="sidebar-section">
      <h6>Precio</h6>
      <div class="d-flex gap-2">
        <input type="number" class="form-control" [(ngModel)]="minPrice" (change)="applyPriceFilter()"
          aria-label="Bajar">
        <input type="number" class="form-control" [(ngModel)]="maxPrice" (change)="applyPriceFilter()"
          aria-label="Subir">
      </div>
    </div>

    <!-- STOCK -->
    <div class="sidebar-section">
      <h6>Disponibilidad</h6>

      <div class="form-check" *ngFor="let option of [
          {value:'all', label:'Todos'},
          {value:'available', label:'En Stock'},
          {value:'low', label:'Poco Stock'} ]">
        <input class="form-check-input" type="radio" name="stockFilter" [value]="option.value" [(ngModel)]="stockFilter"
          (change)="applyStockFilter()" aria-label="Filtrar por stock">
        <label class="form-check-label">{{ option.label }}</label>
      </div>
    </div>

  </aside>

  <!-- CONTENIDO -->
  <main class="catalog-main">

    <!-- HEADER -->
    <div class="content-header d-flex justify-content-between align-items-center">
      <div>
        <h4>{{ filteredCategory === 'todos' ? 'Todos los Productos' : getCategoryName(filteredCategory) }}</h4>
        <span>{{ filteredProducts.length }} productos encontrados</span>
      </div>

      <select class="form-select w-auto" [(ngModel)]="sortOption" (change)="applySort()" aria-label="Ordenar">
        <option value="featured">Destacados</option>
        <option value="price-low">Precio más bajo</option>
        <option value="price-high">Precio más alto</option>
        <option value="name">A-Z</option>
        <option value="rating">Mejor calificación</option>
      </select>
    </div>

    <!-- LISTADO DE PRODUCTOS -->
    <div class="row g-3 mt-3">

      <div class="col-12" *ngIf="filteredProducts.length === 0">
        <div class="text-center py-5">
          <i class="bi bi-search display-1 text-muted"></i>
          <h4 class="mt-3 text-muted">No se encontraron productos</h4>
          <button class="btn btn-primary mt-3" (click)="clearFilters()">
            Limpiar filtros
          </button>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-4 col-lg-3"
           *ngFor="let product of filteredProducts">
        <app-product-card
          [product]="product"
          (viewDetails)="onViewDetails($event)"
          (addToCart)="onAddToCart($event)">
        </app-product-card>
      </div>

    </div>
  </main>
</div>

<!-- TOAST -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="successToast" class="toast" role="alert">
    <div class="toast-header">
      <strong class="me-auto">✔ Éxito</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Cerrar"></button>
    </div>
    <div class="toast-body">
      <span id="toastMessage"></span>
    </div>
  </div>
</div>
